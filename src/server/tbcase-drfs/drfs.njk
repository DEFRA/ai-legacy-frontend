{% extends 'layouts/page.njk' %}

{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "govuk/components/textarea/macro.njk" import govukTextarea %}
{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/fieldset/macro.njk" import govukFieldset %}
{% from "govuk/components/file-upload/macro.njk" import govukFileUpload %}
{% from "govuk/components/warning-text/macro.njk" import govukWarningText %}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}

{% set breadcrumbs = [
  {
    text: "Home",
    href: "/"
  },
  {
    text: "TB Case Form",
    href: "/tbcase/case-details"
  },
  {
    text: "DRFS",
    href: "/tbcase/drfs"
  }
] %}

{% block beforeContent %}
  {{ super() }}
{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <!-- Close form button -->
      <div class="govuk-!-text-align-right govuk-!-margin-bottom-4">
        <a href="/" class="govuk-link" aria-label="Close TB Case Form">
          <span aria-hidden="true">âœ•</span> Close form
        </a>
      </div>
      
      <span class="govuk-caption-l">TBCMS</span>
      <h1 class="govuk-heading-l">TB Case Form - Disease Reporting Forms (DRFS)</h1>
      
      <!-- Case Context Header -->
      <div class="govuk-summary-card govuk-!-margin-bottom-4">
        <div class="govuk-summary-card__title-wrapper">
          <h2 class="govuk-summary-card__title">Case Information</h2>
        </div>
        <div class="govuk-summary-card__content">
          <div class="govuk-grid-row">
            <div class="govuk-grid-column-one-quarter">
              <dt class="govuk-summary-list__key">CPH:</dt>
              <dd class="govuk-summary-list__value">01/234/5678</dd>
            </div>
            <div class="govuk-grid-column-one-quarter">
              <dt class="govuk-summary-list__key">Nat Inc:</dt>
              <dd class="govuk-summary-list__value">25/12345</dd>
            </div>
            <div class="govuk-grid-column-one-quarter">
              <dt class="govuk-summary-list__key">Keeper:</dt>
              <dd class="govuk-summary-list__value">John Smith Farms Ltd</dd>
            </div>
            <div class="govuk-grid-column-one-quarter">
              <dt class="govuk-summary-list__key">Status:</dt>
              <dd class="govuk-summary-list__value">Under Restriction</dd>
            </div>
          </div>
        </div>
      </div>

      <!-- Service Navigation -->
      {% set activePage = "drfs" %}
      {% include "includes/tb-service-navigation.html" %}

      <!-- DRFS Content -->
      <div class="govuk-!-margin-top-6">
        {{ govukInsetText({
          text: "Disease Reporting Forms (DRFS) must be completed for all confirmed TB cases to notify relevant authorities and maintain disease surveillance records."
        }) }}

        <form action="/tbcase/drfs" method="post" novalidate enctype="multipart/form-data">
          
          <!-- Form Type Selection -->
          <fieldset class="govuk-fieldset">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
              <h2 class="govuk-fieldset__heading">Disease Reporting Form</h2>
            </legend>
            
            <div class="govuk-grid-row">
              <div class="govuk-grid-column-one-half">
                {{ govukSelect({
                  id: "form-type",
                  name: "form-type",
                  label: {
                    text: "Form Type",
                    classes: "govuk-label--s"
                  },
                  items: [
                    {
                      value: "",
                      text: "Select form type"
                    },
                    {
                      value: "tb-notification",
                      text: "TB Notification Form"
                    },
                    {
                      value: "post-mortem",
                      text: "Post-Mortem Report"
                    },
                    {
                      value: "laboratory-result",
                      text: "Laboratory Result Form"
                    },
                    {
                      value: "surveillance-report",
                      text: "Surveillance Report"
                    }
                  ]
                }) }}
              </div>
              <div class="govuk-grid-column-one-half">
                {{ govukInput({
                  label: {
                    text: "Form Reference",
                    classes: "govuk-label--s"
                  },
                  hint: {
                    text: "Unique reference number for this form"
                  },
                  id: "form-reference",
                  name: "form-reference",
                  classes: "govuk-input--width-15"
                }) }}
              </div>
            </div>

            <div class="govuk-grid-row">
              <div class="govuk-grid-column-one-half">
                {{ govukDateInput({
                  id: "notification-date",
                  namePrefix: "notification-date",
                  fieldset: {
                    legend: {
                      text: "Notification Date",
                      classes: "govuk-fieldset__legend--s"
                    }
                  },
                  hint: {
                    text: "Date of notification to authorities"
                  },
                  items: [
                    {
                      name: "day",
                      classes: "govuk-input--width-2"
                    },
                    {
                      name: "month",
                      classes: "govuk-input--width-2"
                    },
                    {
                      name: "year",
                      classes: "govuk-input--width-4"
                    }
                  ]
                }) }}
              </div>
              <div class="govuk-grid-column-one-half">
                {{ govukInput({
                  label: {
                    text: "Reporting Authority",
                    classes: "govuk-label--s"
                  },
                  hint: {
                    text: "Authority receiving the notification"
                  },
                  id: "reporting-authority",
                  name: "reporting-authority",
                  value: "APHA South West",
                  classes: "govuk-input--width-20"
                }) }}
              </div>
            </div>
          </fieldset>

          <!-- Disease Details -->
          <fieldset class="govuk-fieldset govuk-!-margin-top-6">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
              <h3 class="govuk-fieldset__heading">Disease Information</h3>
            </legend>
            
            <div class="govuk-grid-row">
              <div class="govuk-grid-column-one-third">
                {{ govukSelect({
                  id: "disease-type",
                  name: "disease-type",
                  label: {
                    text: "Disease Type",
                    classes: "govuk-label--s"
                  },
                  items: [
                    {
                      value: "",
                      text: "Select disease"
                    },
                    {
                      value: "bovine-tuberculosis",
                      text: "Bovine Tuberculosis",
                      selected: true
                    },
                    {
                      value: "atypical-mycobacteria",
                      text: "Atypical Mycobacteria"
                    }
                  ]
                }) }}
              </div>
              <div class="govuk-grid-column-one-third">
                {{ govukSelect({
                  id: "confirmation-method",
                  name: "confirmation-method",
                  label: {
                    text: "Confirmation Method",
                    classes: "govuk-label--s"
                  },
                  items: [
                    {
                      value: "",
                      text: "Select method"
                    },
                    {
                      value: "tuberculin-skin-test",
                      text: "Tuberculin Skin Test"
                    },
                    {
                      value: "gamma-interferon",
                      text: "Gamma Interferon Test"
                    },
                    {
                      value: "post-mortem",
                      text: "Post-Mortem Examination"
                    },
                    {
                      value: "culture",
                      text: "Laboratory Culture"
                    }
                  ]
                }) }}
              </div>
              <div class="govuk-grid-column-one-third">
                {{ govukDateInput({
                  id: "confirmation-date",
                  namePrefix: "confirmation-date",
                  fieldset: {
                    legend: {
                      text: "Confirmation Date",
                      classes: "govuk-fieldset__legend--s"
                    }
                  },
                  items: [
                    {
                      name: "day",
                      classes: "govuk-input--width-2"
                    },
                    {
                      name: "month",
                      classes: "govuk-input--width-2"
                    },
                    {
                      name: "year",
                      classes: "govuk-input--width-4"
                    }
                  ]
                }) }}
              </div>
            </div>

            <div class="govuk-grid-row">
              <div class="govuk-grid-column-one-half">
                {{ govukInput({
                  label: {
                    text: "Laboratory Reference",
                    classes: "govuk-label--s"
                  },
                  hint: {
                    text: "Laboratory sample reference number"
                  },
                  id: "lab-reference",
                  name: "lab-reference",
                  classes: "govuk-input--width-15"
                }) }}
              </div>
              <div class="govuk-grid-column-one-half">
                {{ govukInput({
                  label: {
                    text: "Veterinary Officer",
                    classes: "govuk-label--s"
                  },
                  id: "veterinary-officer",
                  name: "veterinary-officer",
                  value: "Dr. Sarah Wilson BVSc MRCVS",
                  classes: "govuk-input--width-20"
                }) }}
              </div>
            </div>
          </fieldset>

          <!-- Affected Animals -->
          <fieldset class="govuk-fieldset govuk-!-margin-top-6">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
              <h3 class="govuk-fieldset__heading">Affected Animals</h3>
            </legend>
            
            <div class="govuk-grid-row">
              <div class="govuk-grid-column-one-quarter">
                {{ govukInput({
                  label: {
                    text: "Total Animals Tested",
                    classes: "govuk-label--s"
                  },
                  id: "total-tested",
                  name: "total-tested",
                  type: "number",
                  value: "150",
                  classes: "govuk-input--width-5"
                }) }}
              </div>
              <div class="govuk-grid-column-one-quarter">
                {{ govukInput({
                  label: {
                    text: "Reactors",
                    classes: "govuk-label--s"
                  },
                  id: "reactors",
                  name: "reactors",
                  type: "number",
                  value: "2",
                  classes: "govuk-input--width-5"
                }) }}
              </div>
              <div class="govuk-grid-column-one-quarter">
                {{ govukInput({
                  label: {
                    text: "Inconclusive",
                    classes: "govuk-label--s"
                  },
                  id: "inconclusive",
                  name: "inconclusive",
                  type: "number",
                  value: "1",
                  classes: "govuk-input--width-5"
                }) }}
              </div>
              <div class="govuk-grid-column-one-quarter">
                {{ govukInput({
                  label: {
                    text: "Negative",
                    classes: "govuk-label--s"
                  },
                  id: "negative",
                  name: "negative",
                  type: "number",
                  value: "147",
                  classes: "govuk-input--width-5"
                }) }}
              </div>
            </div>
          </fieldset>

          <!-- Clinical Observations -->
          <div class="govuk-!-margin-top-6">
            {{ govukTextarea({
              name: "clinical-observations",
              id: "clinical-observations",
              label: {
                text: "Clinical Observations",
                classes: "govuk-label--m"
              },
              hint: {
                text: "Describe clinical signs, lesions, and other relevant observations"
              },
              rows: 4
            }) }}
          </div>

          <!-- Epidemiological Information -->
          <div class="govuk-!-margin-top-4">
            {{ govukTextarea({
              name: "epidemiological-info",
              id: "epidemiological-info",
              label: {
                text: "Epidemiological Information",
                classes: "govuk-label--m"
              },
              hint: {
                text: "Possible source of infection, contact with other animals, environmental factors"
              },
              rows: 4
            }) }}
          </div>

          <!-- Document Upload -->
          <fieldset class="govuk-fieldset govuk-!-margin-top-6">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
              <h3 class="govuk-fieldset__heading">Supporting Documents</h3>
            </legend>
            
            <div class="govuk-grid-row">
              <div class="govuk-grid-column-one-half">
                {{ govukFileUpload({
                  id: "laboratory-report",
                  name: "laboratory-report",
                  label: {
                    text: "Laboratory Report",
                    classes: "govuk-label--s"
                  },
                  hint: {
                    text: "Upload laboratory test results (PDF, max 10MB)"
                  },
                  accept: ".pdf,.doc,.docx"
                }) }}
              </div>
              <div class="govuk-grid-column-one-half">
                {{ govukFileUpload({
                  id: "post-mortem-report",
                  name: "post-mortem-report",
                  label: {
                    text: "Post-Mortem Report",
                    classes: "govuk-label--s"
                  },
                  hint: {
                    text: "Upload post-mortem examination report (PDF, max 10MB)"
                  },
                  accept: ".pdf,.doc,.docx"
                }) }}
              </div>
            </div>

            <div class="govuk-grid-row govuk-!-margin-top-4">
              <div class="govuk-grid-column-one-half">
                {{ govukFileUpload({
                  id: "photographs",
                  name: "photographs",
                  label: {
                    text: "Photographs",
                    classes: "govuk-label--s"
                  },
                  hint: {
                    text: "Upload relevant photographs (JPG, PNG, max 5MB each)"
                  },
                  accept: ".jpg,.jpeg,.png",
                  attributes: {
                    multiple: true
                  }
                }) }}
              </div>
              <div class="govuk-grid-column-one-half">
                {{ govukFileUpload({
                  id: "additional-documents",
                  name: "additional-documents",
                  label: {
                    text: "Additional Documents",
                    classes: "govuk-label--s"
                  },
                  hint: {
                    text: "Any other supporting documentation"
                  },
                  accept: ".pdf,.doc,.docx,.jpg,.png",
                  attributes: {
                    multiple: true
                  }
                }) }}
              </div>
            </div>
          </fieldset>

          <!-- Uploaded Documents Table -->
          <div class="govuk-!-margin-top-6">
            <h3 class="govuk-heading-m">Uploaded Documents</h3>
            
            {% set documentsTableRows = [
              [
                {
                  text: "Laboratory_Report_2025-01-15.pdf"
                },
                {
                  text: "Laboratory Report"
                },
                {
                  text: "15/01/2025"
                },
                {
                  text: "2.3 MB"
                },
                {
                  html: '<a class="govuk-link" href="#" aria-label="Download Laboratory_Report_2025-01-15.pdf">Download</a> | <a class="govuk-link govuk-link--destructive" href="#" aria-label="Delete Laboratory_Report_2025-01-15.pdf">Delete</a>'
                }
              ],
              [
                {
                  text: "PostMortem_Photos_20250115.zip"
                },
                {
                  text: "Photographs"
                },
                {
                  text: "15/01/2025"
                },
                {
                  text: "8.7 MB"
                },
                {
                  html: '<a class="govuk-link" href="#" aria-label="Download PostMortem_Photos_20250115.zip">Download</a> | <a class="govuk-link govuk-link--destructive" href="#" aria-label="Delete PostMortem_Photos_20250115.zip">Delete</a>'
                }
              ]
            ] %}

            {{ govukTable({
              head: [
                {
                  text: "File Name"
                },
                {
                  text: "Document Type"
                },
                {
                  text: "Upload Date"
                },
                {
                  text: "File Size"
                },
                {
                  text: "Actions"
                }
              ],
              rows: documentsTableRows
            }) }}
          </div>

          <!-- Form Submission -->
          <fieldset class="govuk-fieldset govuk-!-margin-top-6">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
              <h3 class="govuk-fieldset__heading">Form Submission</h3>
            </legend>
            
            <div class="govuk-checkboxes" data-module="govuk-checkboxes">
              <div class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="declaration" name="declaration" type="checkbox" value="confirmed">
                <label class="govuk-label govuk-checkboxes__label" for="declaration">
                  I confirm that the information provided is accurate and complete to the best of my knowledge
                </label>
              </div>
            </div>

            {{ govukWarningText({
              text: "This form will be submitted to the relevant authorities for disease surveillance purposes",
              iconFallbackText: "Warning"
            }) }}
          </fieldset>

          <!-- Form Actions -->
          <div class="govuk-button-group govuk-!-margin-top-6">
            {{ govukButton({
              text: "Submit Form",
              type: "submit",
              name: "action",
              value: "submit"
            }) }}
            
            {{ govukButton({
              text: "Save as draft",
              classes: "govuk-button--secondary",
              name: "action",
              value: "draft"
            }) }}

            {{ govukButton({
              text: "Generate PDF",
              classes: "govuk-button--secondary",
              name: "action",
              value: "generate-pdf"
            }) }}
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock %}
