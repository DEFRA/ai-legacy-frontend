{% extends 'layouts/page.njk' %}

{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "govuk/components/textarea/macro.njk" import govukTextarea %}
{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/fieldset/macro.njk" import govukFieldset %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/warning-text/macro.njk" import govukWarningText %}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}

{% set breadcrumbs = [
  {
    text: "Home",
    href: "/"
  },
  {
    text: "TB Case Form",
    href: "/tbcase/case-details"
  },
  {
    text: "Eartags",
    href: "/tbcase/eartags"
  }
] %}

{% block beforeContent %}
  {{ super() }}
{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <!-- Close form button -->
      <div class="govuk-!-text-align-right govuk-!-margin-bottom-4">
        <a href="/" class="govuk-link" aria-label="Close TB Case Form">
          <span aria-hidden="true">âœ•</span> Close form
        </a>
      </div>
      
      <span class="govuk-caption-l">TBCMS</span>
      <h1 class="govuk-heading-l">TB Case Form - Eartag Management</h1>
      
      <!-- Case Context Header -->
      <div class="govuk-summary-card govuk-!-margin-bottom-4">
        <div class="govuk-summary-card__title-wrapper">
          <h2 class="govuk-summary-card__title">Case Information</h2>
        </div>
        <div class="govuk-summary-card__content">
          <div class="govuk-grid-row">
            <div class="govuk-grid-column-one-quarter">
              <dt class="govuk-summary-list__key">CPH:</dt>
              <dd class="govuk-summary-list__value">01/234/5678</dd>
            </div>
            <div class="govuk-grid-column-one-quarter">
              <dt class="govuk-summary-list__key">Nat Inc:</dt>
              <dd class="govuk-summary-list__value">25/12345</dd>
            </div>
            <div class="govuk-grid-column-one-quarter">
              <dt class="govuk-summary-list__key">Keeper:</dt>
              <dd class="govuk-summary-list__value">John Smith Farms Ltd</dd>
            </div>
            <div class="govuk-grid-column-one-quarter">
              <dt class="govuk-summary-list__key">Status:</dt>
              <dd class="govuk-summary-list__value">Under Restriction</dd>
            </div>
          </div>
        </div>
      </div>

      <!-- Service Navigation -->
      {% set activePage = "eartags" %}
      {% include "includes/tb-service-navigation.html" %}

      <!-- Eartags Content -->
      <div class="govuk-!-margin-top-6">
        {{ govukInsetText({
          text: "All cattle over 27 months must be identified with approved eartags before movement or testing."
        }) }}

        <form action="/tbcase/eartags" method="post" novalidate>
          
          <!-- Add/Update Eartag -->
          <fieldset class="govuk-fieldset">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
              <h2 class="govuk-fieldset__heading">Record Eartag Information</h2>
            </legend>
            
            <div class="govuk-grid-row">
              <div class="govuk-grid-column-one-quarter">
                {{ govukInput({
                  label: {
                    text: "Eartag Number",
                    classes: "govuk-label--s"
                  },
                  hint: {
                    text: "UK followed by 12 digits"
                  },
                  id: "eartag-number",
                  name: "eartag-number",
                  classes: "govuk-input--width-15"
                }) }}
              </div>
              <div class="govuk-grid-column-one-quarter">
                {{ govukSelect({
                  id: "animal-type",
                  name: "animal-type",
                  label: {
                    text: "Animal Type",
                    classes: "govuk-label--s"
                  },
                  items: [
                    {
                      value: "",
                      text: "Select type"
                    },
                    {
                      value: "beef-cattle",
                      text: "Beef Cattle"
                    },
                    {
                      value: "dairy-cattle",
                      text: "Dairy Cattle"
                    },
                    {
                      value: "breeding-bull",
                      text: "Breeding Bull"
                    },
                    {
                      value: "calf",
                      text: "Calf"
                    }
                  ]
                }) }}
              </div>
              <div class="govuk-grid-column-one-quarter">
                {{ govukSelect({
                  id: "sex",
                  name: "sex",
                  label: {
                    text: "Sex",
                    classes: "govuk-label--s"
                  },
                  items: [
                    {
                      value: "",
                      text: "Select sex"
                    },
                    {
                      value: "male",
                      text: "Male"
                    },
                    {
                      value: "female",
                      text: "Female"
                    }
                  ]
                }) }}
              </div>
              <div class="govuk-grid-column-one-quarter">
                {{ govukInput({
                  label: {
                    text: "Breed",
                    classes: "govuk-label--s"
                  },
                  id: "breed",
                  name: "breed",
                  classes: "govuk-input--width-15"
                }) }}
              </div>
            </div>

            <div class="govuk-grid-row">
              <div class="govuk-grid-column-one-third">
                {{ govukDateInput({
                  id: "date-of-birth",
                  namePrefix: "date-of-birth",
                  fieldset: {
                    legend: {
                      text: "Date of Birth",
                      classes: "govuk-fieldset__legend--s"
                    }
                  },
                  hint: {
                    text: "For example, 15 6 2023"
                  },
                  items: [
                    {
                      name: "day",
                      classes: "govuk-input--width-2"
                    },
                    {
                      name: "month",
                      classes: "govuk-input--width-2"
                    },
                    {
                      name: "year",
                      classes: "govuk-input--width-4"
                    }
                  ]
                }) }}
              </div>
              <div class="govuk-grid-column-one-third">
                {{ govukInput({
                  label: {
                    text: "Dam Eartag",
                    classes: "govuk-label--s"
                  },
                  hint: {
                    text: "Mother's eartag number"
                  },
                  id: "dam-eartag",
                  name: "dam-eartag",
                  classes: "govuk-input--width-15"
                }) }}
              </div>
              <div class="govuk-grid-column-one-third">
                {{ govukSelect({
                  id: "current-status",
                  name: "current-status",
                  label: {
                    text: "Current Status",
                    classes: "govuk-label--s"
                  },
                  items: [
                    {
                      value: "",
                      text: "Select status"
                    },
                    {
                      value: "on-holding",
                      text: "On Holding"
                    },
                    {
                      value: "removed",
                      text: "Removed"
                    },
                    {
                      value: "dead",
                      text: "Dead"
                    },
                    {
                      value: "missing",
                      text: "Missing"
                    }
                  ]
                }) }}
              </div>
            </div>

            <!-- TB Testing Information -->
            <fieldset class="govuk-fieldset govuk-!-margin-top-4">
              <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
                <h3 class="govuk-fieldset__heading">TB Testing Information</h3>
              </legend>
              
              <div class="govuk-grid-row">
                <div class="govuk-grid-column-one-third">
                  {{ govukDateInput({
                    id: "last-test-date",
                    namePrefix: "last-test-date",
                    fieldset: {
                      legend: {
                        text: "Last Test Date",
                        classes: "govuk-fieldset__legend--s"
                      }
                    },
                    items: [
                      {
                        name: "day",
                        classes: "govuk-input--width-2"
                      },
                      {
                        name: "month",
                        classes: "govuk-input--width-2"
                      },
                      {
                        name: "year",
                        classes: "govuk-input--width-4"
                      }
                    ]
                  }) }}
                </div>
                <div class="govuk-grid-column-one-third">
                  {{ govukSelect({
                    id: "test-result",
                    name: "test-result",
                    label: {
                      text: "Test Result",
                      classes: "govuk-label--s"
                    },
                    items: [
                      {
                        value: "",
                        text: "Select result"
                      },
                      {
                        value: "negative",
                        text: "Negative"
                      },
                      {
                        value: "reactor",
                        text: "Reactor"
                      },
                      {
                        value: "inconclusive",
                        text: "Inconclusive"
                      },
                      {
                        value: "not-tested",
                        text: "Not Tested"
                      }
                    ]
                  }) }}
                </div>
                <div class="govuk-grid-column-one-third">
                  {{ govukInput({
                    label: {
                      text: "Test Type",
                      classes: "govuk-label--s"
                    },
                    id: "test-type",
                    name: "test-type",
                    classes: "govuk-input--width-15"
                  }) }}
                </div>
              </div>
            </fieldset>

            <div class="govuk-!-margin-top-4">
              {{ govukTextarea({
                name: "eartag-notes",
                id: "eartag-notes",
                label: {
                  text: "Additional Notes",
                  classes: "govuk-label--s"
                },
                hint: {
                  text: "Any additional information about this animal"
                },
                rows: 3
              }) }}
            </div>

            <div class="govuk-button-group govuk-!-margin-top-4">
              {{ govukButton({
                text: "Add/Update Eartag",
                name: "action",
                value: "add-eartag"
              }) }}
            </div>
          </fieldset>

          <!-- Current Eartags Table -->
          <div class="govuk-!-margin-top-8">
            <h3 class="govuk-heading-m">Recorded Eartags</h3>
            
            {% set eartagsTableRows = [
              [
                {
                  text: "UK123456789012"
                },
                {
                  text: "Dairy Cattle"
                },
                {
                  text: "Female"
                },
                {
                  text: "Holstein"
                },
                {
                  text: "15/06/2023"
                },
                {
                  text: "Negative"
                },
                {
                  text: "On Holding"
                },
                {
                  html: '<a class="govuk-link" href="#" aria-label="Edit eartag UK123456789012">Edit</a> | <a class="govuk-link" href="#" aria-label="View full details for eartag UK123456789012">View</a>'
                }
              ],
              [
                {
                  text: "UK987654321098"
                },
                {
                  text: "Beef Cattle"
                },
                {
                  text: "Male"
                },
                {
                  text: "Limousin"
                },
                {
                  text: "22/03/2022"
                },
                {
                  text: "Reactor"
                },
                {
                  text: "Removed"
                },
                {
                  html: '<a class="govuk-link" href="#" aria-label="Edit eartag UK987654321098">Edit</a> | <a class="govuk-link" href="#" aria-label="View full details for eartag UK987654321098">View</a>'
                }
              ],
              [
                {
                  text: "UK555666777888"
                },
                {
                  text: "Dairy Cattle"
                },
                {
                  text: "Female"
                },
                {
                  text: "Jersey"
                },
                {
                  text: "10/01/2024"
                },
                {
                  text: "Inconclusive"
                },
                {
                  text: "On Holding"
                },
                {
                  html: '<a class="govuk-link" href="#" aria-label="Edit eartag UK555666777888">Edit</a> | <a class="govuk-link" href="#" aria-label="View full details for eartag UK555666777888">View</a>'
                }
              ]
            ] %}

            {{ govukTable({
              head: [
                {
                  text: "Eartag Number"
                },
                {
                  text: "Type"
                },
                {
                  text: "Sex"
                },
                {
                  text: "Breed"
                },
                {
                  text: "Date of Birth"
                },
                {
                  text: "Last Test Result"
                },
                {
                  text: "Status"
                },
                {
                  text: "Actions"
                }
              ],
              rows: eartagsTableRows,
              classes: "govuk-!-margin-top-4"
            }) }}
          </div>

          <!-- Eartag Summary -->
          <div class="govuk-!-margin-top-6">
            <div class="govuk-summary-card">
              <div class="govuk-summary-card__title-wrapper">
                <h3 class="govuk-summary-card__title">Eartag Summary</h3>
              </div>
              <div class="govuk-summary-card__content">
                <div class="govuk-grid-row">
                  <div class="govuk-grid-column-one-quarter">
                    <dt class="govuk-summary-list__key">Total Animals:</dt>
                    <dd class="govuk-summary-list__value govuk-!-font-weight-bold">3</dd>
                  </div>
                  <div class="govuk-grid-column-one-quarter">
                    <dt class="govuk-summary-list__key">On Holding:</dt>
                    <dd class="govuk-summary-list__value">2</dd>
                  </div>
                  <div class="govuk-grid-column-one-quarter">
                    <dt class="govuk-summary-list__key">Removed:</dt>
                    <dd class="govuk-summary-list__value">1</dd>
                  </div>
                  <div class="govuk-grid-column-one-quarter">
                    <dt class="govuk-summary-list__key">Reactors:</dt>
                    <dd class="govuk-summary-list__value">1</dd>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Bulk Actions -->
          {{ govukDetails({
            summaryText: "Bulk Actions",
            text: "Import multiple eartags from a CSV file or export current data"
          }) }}

          <div class="govuk-grid-row">
            <div class="govuk-grid-column-one-half">
              <h4 class="govuk-heading-s">Import Eartags</h4>
              <p class="govuk-body">Upload a CSV file with eartag data</p>
              <div class="govuk-form-group">
                <label class="govuk-label" for="eartag-csv">
                  Choose CSV file
                </label>
                <input class="govuk-file-upload" id="eartag-csv" name="eartag-csv" type="file" accept=".csv">
              </div>
              {{ govukButton({
                text: "Import CSV",
                classes: "govuk-button--secondary",
                name: "action",
                value: "import-csv"
              }) }}
            </div>
            <div class="govuk-grid-column-one-half">
              <h4 class="govuk-heading-s">Export Data</h4>
              <p class="govuk-body">Download current eartag data as CSV</p>
              {{ govukButton({
                text: "Export to CSV",
                classes: "govuk-button--secondary",
                name: "action",
                value: "export-csv"
              }) }}
            </div>
          </div>

          <!-- Form Actions -->
          <div class="govuk-button-group govuk-!-margin-top-6">
            {{ govukButton({
              text: "Save and continue",
              type: "submit"
            }) }}
            
            {{ govukButton({
              text: "Save as draft",
              classes: "govuk-button--secondary",
              name: "action",
              value: "draft"
            }) }}
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock %}
