{% extends 'layouts/page.njk' %}

{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/error-message/macro.njk" import govukErrorMessage %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}

{% block beforeContent %}
  {{ super() }}
{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      {{ appHeading({
        text: heading,
        caption: "TB Case Management System"
      }) }}

      <p class="govuk-body">Enter a County Parish Holding (CPH) number to search for holding information.</p>

      <form method="get" action="/" id="cph-search-form">
        {{ govukInput({
          label: {
            text: "CPH Number",
            classes: "govuk-label--m"
          },
          hint: {
            text: "Enter the CPH number in format XX/XXX/XXXX (for example 12/123/1234)"
          },
          id: "cph",
          name: "cph",
          type: "text",
          value: cph,
          classes: "govuk-input--width-20",
          spellcheck: false,
          autocomplete: "off",
          pattern: "[0-9]{2}/[0-9]{3}/[0-9]{4}",
          errorMessage: {
            text: errorMessage
          } if errorMessage
        }) }}

        {{ govukButton({
          text: "Search",
          type: "submit",
          attributes: {
            id: "search-button"
          }
        }) }}
      </form>

      <script>
        document.getElementById('cph-search-form').addEventListener('submit', function(e) {
          e.preventDefault();
          const cphInput = document.getElementById('cph');
          const cphValue = cphInput.value.trim();
          
          if (cphValue) {
            // Redirect to holding details page
            window.location.href = '/holding/' + encodeURIComponent(cphValue);
          }
        });
      </script>

      {% if successMessage %}
        <div class="govuk-!-margin-top-6">
          {{ govukNotificationBanner({
            type: "success",
            text: successMessage
          }) }}
        </div>
      {% endif %}

      {% if errorMessage %}
        <div class="govuk-!-margin-top-6">
          {{ govukNotificationBanner({
            type: "error",
            text: errorMessage
          }) }}
          
          <p class="govuk-body">
            <a href="/cph-create" class="govuk-link">Create a new CPH</a> if you cannot find the holding you're looking for.
          </p>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}
